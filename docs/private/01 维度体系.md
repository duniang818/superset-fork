维度体系或维度建模
发展历史，前世今生。
星型模型，雪花型模型。
维度的分类：
	不变的维度
	缓慢变换的维度
维度层次结构（纵向深入结构）
	嵌入式层次结构
	对应关系：一对多，
雪花模型
维度规范化与反规范化
要求或特征：
	一致性维度，交叉探查
	交叉探查：将不同数据域的商品事实合并在一起进行数据探查，如计算转化率等，或是同一数据域的不同业务合并一起观察。
那么该如何设计维度呢？
维度整合：垂直整合，水平整合
维度拆分：垂直拆分，水平拆分
历史归档：前台归档策略，自定义归档策略，
最小粒度原则（度量）
我们可以形象的将一个主题想象为一颗星星：统计数值型数据（量度）存在于星星中间的事实表；分析角度（维度）是星星的各个角；我们将通过维度的组合，来考察量度。那么，“某年某月某一地区的啤酒销售情况”这样一个主题，就要求我们通过时间和地区两个维度的组合，来考察销售情况这个量度。从而，不同的主题来源于数据仓库中的不同子集，我们可以称之为数据集市。数据集市体现了数据仓库某一方面的信息，多个数据集市构成了数据仓库。
多维分析模型（cube）
维度的层次（Hierarchy）和级别（Level）

常见问题及处理：
1. 缓慢变化维度处理
2. 数据冗余
3. 数据缺失
4. 查询效率
  

### 0.1.1 [

维度建模和范式建模区别





](https://www.baidu.com/link?url=LUIXXLU6JsoqW_qEDPywYTFWndErHhW-YnRytpFBxFTsCE_uWsMeZ32dHJNlJ_ER6IvkJOOen8Wro2OcrIdDNyNzBGEOaa4b53vWsfxreEjw5kc-8OZ2rwwZAzMyahtOw7jSgdizXYV1rCnCRZXF3RJAcihKgYqYC2AYvkW8B-4QCLJdY1a0wSoXdZjMUp2V0KlJUuUq7oQnZGBrJRdBNiTWpF5LJLwSKkx11j5j8C4gd2e3mugLNx_T0t2xPSP9ieblJI49ww5Nu3ltAjU51uj1SS3kMEa4vFPk-ETdcvfxuGVXsSs0R3_KUsWEwxlYrd6qIVbl-LZ2wzd8GFGsRS0ameSptWWIOmdEUVZVR2yMeC_65dqqP79Xc0S8rXHxzazZBGGnQNhbza7kp63h8RW_Bm-WDsV4ReqMj6nbwPzqbINtUV677vweg0VBlwzIg0HMrSLMW48lrdNLOOhrL9rb3IpBRDCoPUu2D_NPoWqeePHt8AmVQT0t736rPv8SPdojYE99PY0AHxiaNEPHB3OQK7EpFmmyq6rxxxj2B1yUGsRTCAW3Bp_eqXR2LA2Y6uNKPR9Ms048zaf4EZC5sK&wd=&eqid=baca9e3c000aa24b00000006664eee17)

[维度建模__](https://www.baidu.com/s?tn=15007414_9_dg&wd=%E7%BB%B4%E5%BA%A6%E5%BB%BA%E6%A8%A1&usm=2&ie=utf-8&rsv_pq=baca9e3c000aa24b&oq=%E7%BB%B4%E5%BA%A6%E5%BB%BA%E6%A8%A1%E5%92%8C%E8%8C%83%E5%BC%8F%E5%BB%BA%E6%A8%A1%E5%8C%BA%E5%88%AB&rsv_t=19aempJPcptx%2Bqh3F7juOwijpdNzkn5D8AcFbzK2UFV4wTMrzlbsbnRlZ2l28NpPN7G1Fg&sa=re_dqa_zy&icon=1)和[范式建模__](https://www.baidu.com/s?tn=15007414_9_dg&wd=%E8%8C%83%E5%BC%8F%E5%BB%BA%E6%A8%A1&usm=2&ie=utf-8&rsv_pq=baca9e3c000aa24b&oq=%E7%BB%B4%E5%BA%A6%E5%BB%BA%E6%A8%A1%E5%92%8C%E8%8C%83%E5%BC%8F%E5%BB%BA%E6%A8%A1%E5%8C%BA%E5%88%AB&rsv_t=19aempJPcptx%2Bqh3F7juOwijpdNzkn5D8AcFbzK2UFV4wTMrzlbsbnRlZ2l28NpPN7G1Fg&sa=re_dqa_zy&icon=1)是两种不同的数据仓库建模技术，==**它们的主要区别在于建模的出发点、数据结构的设计、以及如何处理数据冗余和查询效率。**==12

1. 范式建模：
    
    - 范式建模基于关系型数据库理论，遵循三范式（3NF）原则，即原子性、唯一性和无传递依赖性。
    - 范式建模的特点是数据冗余程度低，数据一致性容易得到保证，但数据分布在多个表中，需要表之间的连接（join）操作，因此在大数据场景下查询效率相对较低。
    - 范式建模强调实体-关系模型，能够保证数据的一致性和准确性，但可能牺牲一定的查询效率。
    
2. 维度建模：
    
    - 维度建模面向业务需求，将业务用事实表和维度表呈现出来，表结构简单，查询简单且效率高。
    - 维度建模不遵循三范式（3NF），允许一定的数据冗余，以数据分析为出发点，设计思路自下而上，适合上游基础数据存储。
    - 维度建模以星型模型为代表，关注用户如何更快速地完成需求分析，同时具有较好的大规模复杂查询的响应性能。
    

总的来说，范式建模适合于数据一致性要求高、数据冗余度低、但查询效率可能较低的场景；而维度建模则适合于业务需求驱动、需要快速分析大量数据的场景，虽然可能牺牲一定的数据一致性来提高查询效率和响应性能。
在这篇文章里，我们将要介绍数据仓库维度建模的基本概念，盘点现在流行的数据仓库的设计方法，即数据仓库的维度建模样式，并一一列举它们的优劣势。读完本文后，企业可以根据自身的需求，选择适合的维度模型样式，进行数据仓库的规划与建设。

## 0.2 一、什么是维度建模？

**维度建模是一种设计和组织[数据仓库](https://www.fanruan.com/solutions/dw)的方法，旨在提供对业务数据的有效查询和分析支持。**该方法主要**关注如何结构化数据，使得用户能够轻松理解、检索和分析数据**。至今，维度建模一直是展现分析数据的首选技术，这一观点之所以被广泛接受，重点就在于它满足了以下两点业务对数据仓库的核心需求：

- 以商业用户可理解的方式发布数据。
- 提供高效的查询性能。

但维度建模也并不是一种新技术，早期主要用于简化数据库。50多年来，经过大量案例的考验，IT组织、行业顾问和商业用户自然而然地被这种**“以单一维度结构满足人们基本需求”**的简单性所吸引。

简单性至关重要，毕竟以具体、有形的方式展示数据集是提高可理解能力的关键。举例来说，如果一个业务经理描述业务为：“我们在各种不同的市场销售产品，并不断度量自身的经营表现。”维度设计者通过理解和分析，了解到业务重点是产品、市场、时间，因此就将业务数据标识为三维，即产品、市场和时间。

爱因斯坦曾说：“凡事应尽量简单，直到不能再简单为止。”从简单的数据模型开始，便是保持设计简单性的基础，若从复杂模型出发，最终会导致模型复杂过度，从而影响查询性能，商业用户也会感到不适。

## 0.3 二、维度建模中包含的重要组件

在维度建模中，主要的概念和组件包括：

**1.** **事实表（Fact Table）：**事实表是数据仓库中的核心表，包含了与业务过程相关的数值型度量或指标。事实表中的每一行通常表示一个业务事件或交易，并与一个或多个维度表相关联。在实际应用时，应该尽量将来源于同一个业务过程的底层度量结果存储于一个维度模型中。

![事实表（Fact Table）](https://www.fanruan.com/bw/wp-content/uploads/2023/12/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20231206134914.jpg)

**2.** **维度（Dimension）：**维度是描述业务过程的属性或特征，用于对事实进行分类和分组。维度包括维度表中的各个字段，例如日期维度中的年、月、日等。

**3.** **维度表（Dimension Table）：**维度表包含了描述事实表中度量的上下文信息，它们用于描述与“谁、什么、哪里、何时、如何、为什么”有关的事件，用于对事实进行分组和筛选的属性，例如时间、地点、产品、客户等。

![维度表（Dimension Table）](https://www.fanruan.com/bw/wp-content/uploads/2023/12/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93%E6%90%AD%E5%BB%BA%E5%AE%9E%E6%88%987.jpg)

**4.** **层次结构（Hierarchy）：**维度可以具有层次结构，即组织成多个级别的数据。例如，时间维度可以包含年、季度、月等层次。

**5.** **度量** **/ 原子指标****（Measure）：**原子指标和度量含义相同，是事实表中的数值型数据，表示业务过程的性能或结果，是用户在数据仓库中分析的关键指标。

多数情况下，数据仓库的好坏直接取决于维度属性的设置；DW/BI环境的分析能力直接取决于维度属性的质量和深度，强大的维度属性带来的回报是健壮的分片-分块分析能力。为维度属性提供详细的业务术语耗费的精力越多，效果就越好。为属性列填充领域值耗费的精力越多，效果就越好。为确保属性值的质量耗费的时间越多，效果就越好。

## 0.4 三、维度模型样式

维度模型一般有两种重要的样式：星型模型、雪花模型。

### 0.4.1 星型模式

![星型模式](https://www.fanruan.com/bw/wp-content/uploads/2023/12/star-schema-1024x429.jpg)

星型模式是维度模型最简单的形式，也是数据仓库以及数据集市开发中使用最广泛的形式。一个星型模式中可以有一个或多个事实表，每个事实表引用任意数量的维度表。星型模式的物理模型像一颗星星的形状，中心是一个事实表，围绕在事实表周围的维度表表示星星的放射状分支。

优势：

- **查询性能高：**星型模型在查询性能上表现优秀。由于维度表与事实表之间的简单连接，查询通常更加直观和高效。
- **易于理解：**星型模型的结构相对简单，易于理解和维护。这使得业务用户更容易对数据进行理解和分析。
- **灵活性：**星型模型提供了良好的灵活性，可以轻松地添加、删除或修改维度，以满足业务变化的需求。
- **容易扩展：**星型模型的设计使得数据仓库易于扩展。新的维度可以简单地添加到模型中，而不会显著影响现有结构。
- **适用于特定领域：**星型模型特别适用于特定主题或领域的数据仓库，因为它使得对业务过程的特定方面进行深入分析变得简单。

劣势：

- **复杂度增加：**随着业务需求的复杂化，星型模型可能变得复杂。在某些情况下，当业务过程和需求变得非常复杂时，星型模型可能无法有效地捕捉到所有复杂关系。
- **不适用于所有业务场景：** 星型模型可能不适用于所有类型的业务。某些业务情景可能需要更灵活或规范化的模型，例如雪花模型。
- **存储冗余：**一些情况下，星型模型可能导致存储冗余，因为一些维度信息可能在事实表中重复存储。
- **不适用于大规模交易处理：**在大规模交易处理场景下，星型模型可能不是最佳选择。对于大量实时交易的系统，可能需要考虑其他模型。

### 0.4.2 雪花模式

雪花模式是一种多维模型中表的逻辑布局，其实体关系图有类似于雪花的形状，因此得名。

![雪花模式](https://www.fanruan.com/bw/wp-content/uploads/2023/12/snowflake-1024x489.jpg)

与星型模式相同，雪花模式也是由事实表和维度表所组成，所谓的雪花就是将星型模式中的维度表进行规范化处理，当所有的维度表完成规范化后，就形成了以事实表为中心的雪花型结构。

将维度表进行规范化的具体做法是：把低基数的属性从维度表中移除并形成单独的表，基数指的是一个字段中不同值的个数，如主键列具有唯一值，有最高的基数，而像性别这样的列基础就很低。

在雪花模式中，一个维度被规范化成另个关联的表，而在星型模式中，每个维度由一个单一的维度表所表示、一个规范化的维度对应一组具有层次关系的维度表，而事实表作为雪花模式里的子表，存在具有层次关系的多个父表。

优势：

- **规范化减少数据冗余：**雪花模式通过规范化维度表，可以有效减少数据冗余。相较于星型模型，雪花模型更强调将维度表的层次结构规范化为多个相关的表，从而节省存储空间。
- **更好的数据一致性：**由于数据被规范化，雪花模式有助于维护更好的数据一致性。更新或修改维度数据时，只需要更新规范化的维度表，而不是多个星型模型中的相同数据。
- **适用于高度标准化的数据：**在某些业务场景中，特别是对于高度标准化的数据，雪花模式可能更适用。例如，某些金融或医疗领域的数据可能需要强调更多的规范化。

劣势：

- **复杂性增加：**相对于星型模型，雪花模式的设计更为复杂。多个表之间的关系可能增加了查询的复杂性，对于用户而言，理解和使用也可能更具挑战性。
- **查询性能相对较低：**由于需要在多个表之间进行连接，雪花模式的查询性能可能相对较低。在某些情况下，特别是对于大型数据集，查询可能会变得更为耗时。
- **不利于某些报表工具：**一些报表工具可能更适用于星型模型，因为它们更直观地处理星型结构。对于使用这些工具的组织，雪花模式可能引入了额外的复杂性。

## 0.5 四、结语

在本文中，我们探讨了什么是维度建模，以及维度建模两种主要的建模样式：星型模型、雪花模型。每种维度建模样式都有其独特的优势和劣势，企业在选择适当的模型时应仔细考虑自身需求。如果业务更注重直观性和快速查询，星型模型可能是不二选择；而对于强调一致性和规范化的行业，雪花模型可能更符合要求。无论选择何种方式，都应致力于构建一个符合业务需求、易于维护和具有良好性能的数据仓库，以为企业的决策提供更强大的支持。

帆软软件深耕数字行业，能够基于强大的底层数据技术，为企业打破数据孤岛，搭建[**数据仓库**](https://www.fanruan.com/solutions/dw)，梳理指标体系。为并企业提供数据仓库的上层应用生产力，结合强大的数据产品，建立全面、便捷、直观的经营、财务、绩效、风险和监管一体化的**报表系统**与**数据分析平台**，并为各业务部门人员及领导提供PC端、移动端等**可视化大屏**查看方式，有效提高工作效率与需求响应速度。

![](https://www.fanruan.com/bw/wp-content/uploads/2023/12/datawarehouse-1-1024x538.png)

若您还想了解更多数据仓库建设解决方案，请点击：[《帆软数据仓库和商业智能解决方案》](https://www.fanruan.com/solutions/dw)，或点击下方图片👇，获取各行业全业务场景数仓搭建案例及资料。
# 1 漫谈数据仓库之维度建模

文 | 商业智能BI相关文章 2023-05-30 10:45:03 阅读次数：18,581 次浏览

接上次一篇《[一文读懂数据仓库、数据集市、数据库的区别与关联](https://www.fanruan.com/bw/mtsj#wechat_redirect)》，继续讲讲数据仓库。今天这篇详细介绍数据仓库维度建模技术，并重点讨论三种基于ER建模/关系建模/维度建模的数据仓库总体建模体系：规范化数据仓库，维度建模数据仓库，以及独立数据集市。数仓建模也是数据仓库建设最重要的一支。

全文共 5000 字，读完需要13分钟~

先抛目录~

维度建模的基本概念

维度建模的三种模式

实例：零售公司销售主题的维度建模

更多可能的事实属性

经典星座模型

缓慢变化维度问题

数据仓库建模体系之规范化数据仓库

数据仓库建模体系之维度建模数据仓库

数据仓库建模体系之独立数据集市

三种数据仓库建模体系对比

### 1.1.1 维度建模的基本概念

维度建模是专门用于分析型数据库、数据仓库、数据集市建模的方法。

它本身属于一种关系建模方法，但和之前在操作型数据库中介绍的关系建模方法相比增加了两个概念：

#### 1.1.1.1 1、维度表

表示对分析主题所属类型的描述。比如”昨天早上张三在京东花费200元购买了一个皮包”。那么以购买为主题进行分析，可从这段信息中提取三个维度：时间维度(昨天早上)，地点维度(京东), 商品维度(皮包)。通常来说维度表信息比较固定，且数据量小。

#### 1.1.1.2 2、事实表

表示对分析主题的度量。比如上面那个例子中，200元就是事实信息。事实表包含了与各维度表相关联的外码，并通过JOIN方式与维度表关联。事实表的度量通常是数值类型，且记录数会不断增加，表规模迅速增长。

### 1.1.2 维度建模的三种模式

#### 1.1.2.1 1、星形模式

星形模式(Star Schema)是最常用的维度建模方式，下图展示了使用星形模式进行维度建模的关系结构：

![数据仓库维度建模,数据集市,维度建模是什么,数据建模案例,数据仓库解决方案](https://www.fanruan.com/bw/wp-content/uploads/2020/07/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93%E7%BB%B4%E5%BA%A6%E5%BB%BA%E6%A8%A11.jpg)

可以看出，星形模式的维度建模由一个事实表和一组维表成，且具有以下特点：

维表只和事实表关联，维表之间没有关联；

每个维表的主码为单列，且该主码放置在事实表中，作为两边连接的外码；

以事实表为核心，维表围绕核心呈星形分布；

#### 1.1.2.2 2、雪花模式

雪花模式(Snowflake Schema)是对星形模式的扩展，每个维表可继续向外连接多个子维表。下图为使用雪花模式进行维度建模的关系结构：

![数据仓库维度建模,数据集市,维度建模是什么,数据建模案例,数据仓库解决方案](https://www.fanruan.com/bw/wp-content/uploads/2020/07/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93%E7%BB%B4%E5%BA%A6%E5%BB%BA%E6%A8%A12.jpg)

星形模式中的维表相对雪花模式来说要大，而且不满足规范化设计。雪花模型相当于将星形模式的大维表拆分成小维表，满足了规范化设计。然而这种模式在实际应用中很少见，因为这样做会导致开发难度增大，而数据冗余问题在数据仓库里并不严重。

#### 1.1.2.3 3、星座模式

星座模式(Fact Constellations Schema)也是星型模式的扩展。基于这种思想就有了星座模式：

![数据仓库维度建模,数据集市,维度建模是什么,数据建模案例,数据仓库解决方案](https://www.fanruan.com/bw/wp-content/uploads/2020/07/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93%E7%BB%B4%E5%BA%A6%E5%BB%BA%E6%A8%A13.jpg)

前面介绍的两种维度建模方法都是多维表对应单事实表，但在很多时候维度空间内的事实表不止一个，而一个维表也可能被多个事实表用到。在业务发展后期，绝大部分维度建模都采用的是星座模式。

#### 1.1.2.4 4、三种模式对比

归纳一下，星形模式/雪花模式/星座模式的关系如下图所示：

![数据仓库维度建模,数据集市,维度建模是什么,数据建模案例,数据仓库解决方案](https://www.fanruan.com/bw/wp-content/uploads/2020/07/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93%E7%BB%B4%E5%BA%A6%E5%BB%BA%E6%A8%A14.jpg)

雪花模式是将星型模式的维表进一步划分，使各维表均满足规范化设计。而星座模式则是允许星形模式中出现多个事实表。本文后面部分将具体讲到这几种模式的使用，请读者结合实例体会。

### 1.1.3 实例：零售公司销售主题的维度建模

在进行维度建模前，首先要了解用户需求。而笔者在数据库系列的第一篇就讲过，ER建模是当前收集和可视化需求的最佳技术。因此假定和某零售公司进行多次需求PK后，得到以下ER图：

![数据仓库维度建模,数据集市,维度建模是什么,数据建模案例,数据仓库解决方案](https://www.fanruan.com/bw/wp-content/uploads/2020/07/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93%E7%BB%B4%E5%BA%A6%E5%BB%BA%E6%A8%A15.jpg)

随后可利用建模工具将ER图直接映射到关系图：

![数据仓库维度建模,数据集市,维度建模是什么,数据建模案例,数据仓库解决方案](https://www.fanruan.com/bw/wp-content/uploads/2020/07/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93%E7%BB%B4%E5%BA%A6%E5%BB%BA%E6%A8%A16.jpg)

需求搜集完毕后，便可进行维度建模了。本例采用星形模型维度建模。但不论采取何种模式，维度建模的关键在于明确下面四个问题：

#### 1.1.3.1 1、哪些维度对主题分析有用？

本例中，根据产品(PRODUCT)、顾客(CUSTOMER)、商店(STORE)、日期(DATE)对销售额进行分析是非常有帮助的；

#### 1.1.3.2 2、如何使用现有数据生成维表？

维度PRODUCT可由关系PRODUCT，关系VENDOR，关系CATEGORY连接得到；

维度CUSTOMER和关系CUSTOMER相同；

维度STORE可由关系STROE和关系REGION连接得到；

维度CALENDAR由关系SALESTRANSACTION中的TDate列分离得到；

#### 1.1.3.3 3、用什么指标来”度量”主题？

本例的主题是销售，而销量和销售额这两个指标最能直观反映销售情况；

#### 1.1.3.4 4、如何使用现有数据生成事实表？

销量和销售额信息可以由关系SALESTRANSACTION和关系SOLDVIA，关系PRODUCT连接得到；

明确这四个问题后，便能轻松完成维度建模：

![数据仓库维度建模,数据集市,维度建模是什么,数据建模案例,数据仓库解决方案](https://www.fanruan.com/bw/wp-content/uploads/2020/07/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93%E7%BB%B4%E5%BA%A6%E5%BB%BA%E6%A8%A17.jpg)

细心的读者会发现三个问题：1. 维表不满足规范化设计(不满足3NF)；2. 事实表也不满足规范化设计(1NF都不满足)；3. 维度建模中各维度的主码由***ID变成***Key；

对于前两个问题，由于当前建模环境是数据仓库，而没有更新操作，所以不需要严格做规范化设计来消除冗余避免更新异常。

因此虽然可以以雪花模型进行维度建模，如下所示：

![数据仓库维度建模,数据集市,维度建模是什么,数据建模案例,数据仓库解决方案](https://www.fanruan.com/bw/wp-content/uploads/2020/07/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93%E7%BB%B4%E5%BA%A6%E5%BB%BA%E6%A8%A18.jpg)

但这样会加大查询人员负担：每次查询都涉及到太多表了。因此在实际应用中，雪花模型仅是一种理论上的模型。星座模型则出现在”维度建模数据仓库”中，本文后面将会讲到。

对于第三个问题，***Key这样的字段被称为代理码(surrogate key)，它是一个通过自动分配整数生成的主码，没有任何其他意义。使用它主要是为了能够处理”缓慢变化的维度”，本文后面会仔细分析这个问题，这里不纠结。

### 1.1.4 更多可能的事实属性

除了对应到维度的外码和度量属性，事实表中还常常考虑另外两个属性：事务标识码和事务时间。

事务标识码通常被命名为TID，其意义就是各种订单号，事务编号…… 为什么将这个属性放到事实表而不是维表中呢？一个主要原因是它的数量级太大了，这样每次查询都会耗费很多资源来Join。这种将某些逻辑意义上的维度放到事实表里的做法被称为退化维度。

将事务时间维度放到事实表中的考虑也是出于相同考虑。然而这么设计又一次”逆规范化”了：事务标识码非主码却决定事务标识时间，显然违背了3NF。但现在我们是为数据仓库建模，所以这样做是OK的。另外在分布式的数据仓库中，这个字段十分重要。因为事实表的数量级非常大，Hive或者Spark SQL这类分布式数据仓库工具都会对这些数据进行分区。任何成熟的分布式计算平台中都应禁止开发人员建立非分区事实表，并默认分区字段为(当天)日期。

#### 1.1.4.1 经典星座模型

前文已经讲过，有多个事实表的维度模型被称为星座模型。星座模型主要有以下两大作用：共享维度和设置细节/聚集事实表。下面分别对这两种情况进行分析：

#### 1.1.4.2 1、共享维度

以前文提到的零售公司为例，假如该公司质量监管部门希望用分析销售主题同样的方法分析劣质产品，那么此时不需要重新维度建模，只需往模型里加入一个新的劣质产品事实表。之后新的数据仓库维度建模结果如下：

#### 1.1.4.3 2、细节/聚集事实表

细节事实表(detailed fact tables)中每条记录表示单一事实，而聚集事实表(aggregated fact tables)中每条记录则聚合了多条事实。从表的字段上看，细节事实表通常有设置TID属性，而聚集事实表则无。

两种事实表各有优缺点，细节事实表查询灵活但是响应速度相对慢，而聚集事实表虽然提高了查询速度，但使查询功能受到一定限制。一个常见的做法是使用星座模型同时设置两种事实表(可含多个聚集事实表)。这种设计方法中，聚集事实表使用和细节事实表细节事实表的维度。如下维度建模方法采用星座模型综合了细节事实表和两种聚集事实表：

#### 1.1.4.4 缓慢变化维度问题

虽然，维表的数据比事实表更稳定。但不论如何维度在某些时候总会发生一些变化。在之前曾抛出一个问题：为什么维度建模后的关系不是***ID，而是***Key了。这样做的目的其实就是为了解决一种被称为缓慢维度变化(slowly changing dimension)的问题。在维度变化后，一部分历史信息就被丢掉了。比如张三是某公司会员。

但仅仅这么做还是不够的，代理码需要配合时间戳，以及行标识符使用才能解决缓慢维度变化的问题。如下CUSTOMER表使用该方法避免缓慢维度变化：

![数据仓库维度建模,数据集市,维度建模是什么,数据建模案例,数据仓库解决方案](https://www.fanruan.com/bw/wp-content/uploads/2020/07/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93%E7%BB%B4%E5%BA%A6%E5%BB%BA%E6%A8%A19.jpg)

可以看到用户张三对应新维度的TaxBracket状态由Low变成了High。如果需要统计张三的相关行为，那么可以让所有记录用CustomerID字段Join事实表；如果要统计当前TaxBracket为Low的用户状态，则可将Row Indicator字段为Current的记录用CustomerKey字段Join事实表；如果要统计历史TaxBracket状态为Low的用户情况，则只需要将TaxBracket属性为Low的用户记录的CustomerKey属性与事实表关联。

### 1.1.5 数据仓库建模体系之规范化数据仓库

所谓”数据仓库建模体系”，指的是数据仓库从无到有的一整套建模方法。最常见的三种数据仓库建模体系分别为：规范化数据仓库，维度建模数据仓库，独立数据集市。很多书将它们称为”数据仓库建模方法”，但笔者认为数据仓库建模体系更能准确表达意思，请允许我自作主张一次吧：）。下面首先来介绍规范化数据仓库。

规范化数据仓库(normalized data warehouse)顾名思义，其中是规范化设计的分析型数据库，然后基于这个数据库为各部门建立数据集市。总体架构如下图所示：

![数据仓库维度建模,数据集市,维度建模是什么,数据建模案例,数据仓库解决方案](https://www.fanruan.com/bw/wp-content/uploads/2020/07/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93%E7%BB%B4%E5%BA%A6%E5%BB%BA%E6%A8%A110.jpg)

该建模体系首先对ETL得到的数据进行ER建模，关系建模，得到一个规范化的数据库模式。然后用这个中心数据库为公司各部门建立基于维度建模的数据集市。各部门开发人员大都从这些数据集市提数，通常来说不允许直接访问中心数据库。

### 1.1.6 数据仓库建模体系之维度建模数据仓库

非维度建模数据仓库(dimensionally modeled data warehouse)是一种使用交错维度进行建模的数据仓库，其总体架构如下图所示：

![数据仓库维度建模,数据集市,维度建模是什么,数据建模案例,数据仓库解决方案](https://www.fanruan.com/bw/wp-content/uploads/2020/07/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93%E7%BB%B4%E5%BA%A6%E5%BB%BA%E6%A8%A111.jpg)

该建模体系首先设计一组常用的度集合(conformed dimension)，然后创建一个大星座模型表示所有分析型数据。如果这种一致维度不满足某些数据分析要求，自然也可在数据仓库之上继续构建新的数据集市。

### 1.1.7 数据仓库建模体系之独立数据集市

独立数据集市的建模体系是让公司的各个组织自己创建并完成ETL，自己维护自己的数据集市。其总体架构如下图所示：

![数据仓库维度建模,数据集市,维度建模是什么,数据建模案例,数据仓库解决方案](https://www.fanruan.com/bw/wp-content/uploads/2020/07/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93%E7%BB%B4%E5%BA%A6%E5%BB%BA%E6%A8%A112.jpg)

从技术上来讲这是一种很不值得推崇的方式，因为将使信息分散，影响了企业全局范围内数据分析的效率。此外，各组织之间的ETL架构相互独立无法复用，也浪费了企业的开发资源。然而出于某些公司制度及预算方面的考虑，有时也会使用到这种建模体系。

### 1.1.8 三种数据仓库建模体系对比

规范化数据仓库和维度建模数据仓库分别是Bill Inmon和Ralph Kimball提出的方法。关于哪种方法更好，哪种方法更优秀的争论已经由来已久。但随着这两种数据仓库应用越来越多，人们也逐渐了解到两种数据仓库的优劣之处，如下表所示：

![数据仓库维度建模,数据集市,维度建模是什么,数据建模案例,数据仓库解决方案](https://www.fanruan.com/bw/wp-content/uploads/2020/07/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93%E7%BB%B4%E5%BA%A6%E5%BB%BA%E6%A8%A113.jpg)

产生这些区别的根本之处在于规范化数据仓库需要对企业全局进行规范化建模，这将导致较大的工作量。但这一步必须完成好，才能继续往上建设数据集市。因此也就导致规范化数据仓库需要一定时间才能投入使用，敏捷性相对后者来说略差。但是规范化数据仓库一旦建立好了，则以后数据就更易于管理。而且由于开发人员不能直接使用其中心数据库，更加确保了数据质量。还有由于中心数据库是采用规范化设计的，冗余情况也会更少。

然而另一方面维度建模数据仓库除了敏捷性更强，而且适用于业务变化比较频繁的情况，对开发人员的要求也没有规范化数据仓库那么高。总之各有利弊，具体实施时需要仔细的权衡。

### 1.1.9 小结

数据仓库建模是一个综合性技术，需要使用到ER建模、关系建模、维度建模等技术。而且当企业业务复杂的时候，这部分工作更是需要专门团队与业务方共同合作来完成。因此一个优秀的数据仓库建模团队既要有坚实的数据仓库建模技术，还要有对现实业务清晰、透彻的理解。

比如，目前市面上很流行的帆软公司的软件——FineBI，功能算是前沿的，可做[BI](https://www.finebi.com/)报表，内置了10+行业解决方案和几十种[可视化](https://www.fanruan.com/bw/keshihua)大屏模板demo，只需要直接把数据放入到模板中，马上就可以生成数据，无需花费很多时间，很适合企业使用。

[FineDataLink](https://www.finedatalink.com/)是一款做BI分析前的ETL工具，可以直接把数据接入到BI，同时可以把数据分享给数据中心，或者第三方需要用到数据的地方。同时，FineDataLink可以轻松地将来自各种数据源的数据集成到FineBI中，从而帮助企业更好地使用FineBI的数据分析和可视化功能，为企业带来更好的数据管理和分析体验。
![[Pasted image 20240523160816.png]]
物理模型，概念模型，物理表，虚拟表，视图。
# 2 数据模型(data model)

文 | Smartbi大数据百科 2022-02-18 阅读次数：34673 次浏览

商业智能BI产品更多介绍：[https://www.smartbi.com.cn/](https://www.smartbi.com.cn/)

### 2.1.1 什么是数据模型

数据模型是现实世界数据特征的抽象，用于描述一组数据的概念和定义。数据模型是数据库中数据的存储方式，是数据库系统的基础。在数据库中，数据的物理结构又称数据的存储结构，就是数据元素在计算机存储器中的表示及其配置；数据的逻辑结构则是指数据元素之间的逻辑关系，它是数据在用户或程序员面前的表现形式，数据的存储结构不一定与逻辑结构一致。

  

### 2.1.2 数据模型的主要包括

数据模型的研究包括以下三个方面：

  

**1.概念数据模型**

这是面向数据库用户的现实世界的数据模型，主要用来描述世界的概念化结构，它使数据库的设计人员在设计的初始阶段，摆脱计算机系统及数据库管理系统的具体技术问题，集中精力分析数据以及数据之间的联系等，与具体的数据库管理系统无关。概念数据模型必须换成逻辑数据模型，才能在数据库管理系统中实现。

**2.逻辑数据模型**

这是用户在数据库中看到的数据模型，是具体的数据库管理系统所支持的数据模型，主要有网状数据模型、层次数据模型和关系数据模型三种类型。此模型既要面向用户，又要面向系统，主要用于数据库管理系统的实现。在数据库中用数据模型来抽象、表示和处理现实世界中的数据和信息，主要是研究数据的逻辑结构。

**3.物理数据模型**

这是描述数据在存储介质上的组织结构的数据模型，它不但与具体的数据库管理系统有关，而且还与操作系统和硬件有关。每一种逻辑数据模型在实现时都有与其相对应的物理数据模型。数据库管理系统为了保证其独立性与可移植性，将大部分物理数据模型的实现工作交由系统自动完成，而设计者只设计索引、聚集等特殊结构。

  

### 2.1.3 数据模型基本概念

**1.三个世界的划分**

数据的加工是一个逐步转化的过程，经历了现实世界、信息世界和计算机世界这3个不同的世界，经历了两级抽象和转换，如图所示。

  

　　![图数据转换过程.jpg](https://www.smartbi.com.cn/Uploads/ue/image/20220218/1645172430177391.jpg "1645172430177391.jpg")

  

**(1)现实世界**

现实世界是指客观存在的事物及其相互间的联系。现实世界中的事物有着众多的特征和千丝万缕的联系，但人们只选择感兴趣的一部分来描述，如学生，人们通常用学号、姓名、班级、成绩等特征来描述和区分，而对身高、体重、长相不太关心；而如果对象是演员，则可能正好截然相反。事物可以是具体的、可见的实物，也可以是抽象的事物。

**(2)信息世界**

信息世界是人们把现实世界的信息和联系，通过“符号”记录下来，然后用规范化的数据库定义语言来定义描述而构成的一个抽象世界。信息世界实际上是对现实世界的一种抽象描述。在信息世界中，不是简单地对现实世界进行符号化，而是要通过筛选、归纳、总结、命名等抽象过程产生出概念模型，用以表示对现实世界的抽象与描述。

**(3)计算机世界**

计算机世界是将信息世界的内容数据化后的产物。将信息世界中的概念模型，进一步的转换成数据模型，形成便于计算机处理的数据表现形式。

**2.数据模型的三要素**

数据模型所描述的内容有3个部分，分别是数据结构、数据操作和数据约束。

**(1)数据结构**

数据结构用于描述系统的静态特征，包括数据的类型、内容、性质及数据之间的联系等。它是数据模型的基础，也是刻画一个数据模型性质最重要的方面。在数据库系统中，人们通常按照其数据结构的类型来命名数据模型。例如，层次模型和关系模型的数据结构就分别是层次结构和关系结构。

**(2)数据操作**

数据操作用于描述系统的动态特征，包括数据的插入、修改、删除和查询等。数据模型必须定义这些操作的确切含义、操作符号、操作规则及实现操作的语言。

**(3)数据约束**

数据的约束条件实际上是一组完整性规则的集合。完整性规则是指给定数据模型中的数据及其联系所具有的制约和存储规则，用以限定符合数据模型的数据库及其状态的变化，以保证数据的正确性、有效性和相容性。例如，限制一个表中学号不能重复，或者年龄的取值不能为负，都属于完整性规则。

  

### 2.1.4 数据模型的分类

数据库的类型是根据数据模型来划分的，而任何一个DBMS也是根据数据模型有针对性地设计出来的，这就意味着必须把数据库组织成符合DBMS规定的数据模型。目前成熟地应用在数据库系统中的数据模型有：层次模型、网状模型和关系模型。它们之间的根本区别在于数据之间联系的表示方式不同(即记录型之间的联系方式不同)。层次模型以“树结构”表示数据之间的联系。网状模型是以“图结构”来表示数据之间的联系。关系模型是用“二维表”(或称为关系)来表示数据之间的联系的。

**1．层次模型(Hierchical)**

层次模型是数据库系统最早使用的一种模型，它的数据结构是一棵“有向树”。根结点在最上端，层次最高，子结点在下，逐层排列。层次模型的特征是：

  

· 有且仅有一个结点没有父结点，它就是根结点；

  

· 其他结点有且仅有一个父结点。图所示为一个系教务管理层次数据模型，图(a)所示的是实体之间的联系，图(b)所示的是实体型之间的联系。

  

　　![数据模型.jpg](https://www.smartbi.com.cn/Uploads/ue/image/20220218/1645172540783557.jpg "1645172540783557.jpg")

  

最有影响的层次模型的DBS是20世纪60年代末，IBM公司推出的IMS层次模型数据库系统。

**2．网状模型(Network)**

网状模型以网状结构表示实体与实体之间的联系。网中的每一个结点代表一个记录类型，联系用链接指针来实现。网状模型可以表示多个从属关系的联系，也可以表示数据间的交叉关系，即数据间的横向关系与纵向关系，它是层次模型的扩展。网状模型可以方便地表示各种类型的联系，但结构复杂，实现的算法难以规范化。其特征是：

  

· 允许结点有多于一个父结点；

  

· 可以有一个以上的结点没有父结点。

下图所示为一个系教务管理网状数据模型。

  

　　![系教务管理层次数据模型.jpg](https://www.smartbi.com.cn/Uploads/ue/image/20220218/1645172596815040.jpg "1645172596815040.jpg")

  

**3．关系模型(Relation)**

关系模型以二维表结构来表示实体与实体之间的联系，它是以关系数学理论为基础的。关系模型的数据结构是一个“二维表框架”组成的集合。每个二维表又可称为关系。在关系模型中，操作的对象和结果都是二维表。关系模型是目前最流行的数据库模型。支持关系模型的数据库管理系统称为关系数据库管理系统，Access就是一种关系数据库管理系统。图所示为一个简单的关系模型，其中图(a)所示为关系模式，图(b)所示为这两个关系模型的关系，关系名称分别为教师关系和课程关系，每个关系均含3个元组，其主码均为“教师编号”。

  

　　![图关系模型.jpg](https://www.smartbi.com.cn/Uploads/ue/image/20220218/1645172628628223.jpg "1645172628628223.jpg")

  

· 描述的一致性，不仅用关系描述实体本身，而且也用关系描述实体之间的联系；

  

· 可直接表示多对多的联系；

  

· 关系必须是规范化的关系，即每个属性是不可分的数据项，不许表中有表；

  

· 关系模型是建立在数学概念基础上的，有较强的理论依据。

在关系模型中基本数据结构就是二维表，不用像层次或网状那样的链接指针。记录之间的联系是通过不同关系中同名属性来体现的。例如，要查找“刘晋”老师所上的课程，可以先在教师关系中根据姓名找到教师编号“1984030”，然后在课程关系中找到“1984030”任课教师编号对应的课程名即可。通过上述查询过程，同名属性教师编号起到了连接两个关系的纽带作用。由此可见，关系模型中的各个关系模式不应当是孤立的，也不是随意拼凑的一堆二维表，它必须满足相应的要求。

关系是一个二维表，即元组的集合。关系框架是一个关系的属性名表。形式化表示为：  ![公式.png](https://www.smartbi.com.cn/Uploads/ue/image/20220218/1645172755552104.png "1645172755552104.png")

其中，R为关系名，Ai(i=1，2，…，n)为关系的属性名。

关系之间通过公共属性实现联系。例如，图所示为两个关系，通过“教师编号”公共属性实现两个关系之间的联系。

关系数据库是指对应于一个关系模型的所有关系的集合。例如，在一个教务管理关系数据库中，包含教师关系、课程关系、学生关系、任课关系、成绩关系等。